type Username @entity {
  id: ID!
  owner: Account
  unameRegistrationOrders: [UsernameRegistrationOrder!]
    @derivedFrom(field: "username")
  createdAt: DateTime
  createdAtBlock: Int
}

type Account @entity {
  id: ID!
  usernames: [Username!] @derivedFrom(field: "owner")
  unameRegistrationOrders: [UsernameRegistrationOrder!]
    @derivedFrom(field: "registrant")

  energyBoxes: [EnergyBox!] @derivedFrom(field: "owner")
}

type UsernameRegistrationOrder @entity {
  "Attempt ID from remark and it's the same value for all purchase, confirmation and refund(if it's existing) remarks"
  id: ID!
  blockHashSellerChain: String
  blockHashUnameHostChain: String
  confirmedBlockHashSellerChain: String
  confirmedRemarkCallId: String
  refundBlockHashSellerChain: String
  refundRemarkCallId: String
  registrant: Account!
  username: Username!
  price: BigInt!
  "TODO should be reviewed"
  currency: String!
  purchaseTx: Transfer
  refundTx: Transfer
  status: RegistrationStatus
  refundStatus: RefundStatus
  purchaseRmrk: JSON
  confirmationRmrk: JSON
  refundRmrk: JSON
  errorRegistration: UsernameRegistrationOrderError
  errorRefund: UsernameRegistrationOrderError
}

type EnergyBox @entity {
  "Attempt ID from remark and it's the same value for all generation, confirmation and refund(if it's existing) remarks"
  id: ID!
  blockHashSellerChain: String
  blockHashEnergyHostChain: String
  energyAmount: BigInt!
  boxPrice: BigInt!
  "TODO should be reviewed"
  currency: String!
  owner: Account
  purchaseTx: Transfer
  refundTx: Transfer
  status: RegistrationStatus
  refundStatus: RefundStatus
  generationRmrk: JSON
  confirmationRmrk: JSON
  refundRmrk: JSON
}

type Transfer @entity {
  id: ID!
  blockHeight: Int!
  blockHash: String!
  timestamp: DateTime!
  amount: BigInt!
  "TODO should be reviewed"
  currency: String
  from: Account!
  to: Account!
  addressChainPrefix: String!
}

enum RegistrationStatus {
  Processing
  Successful
  Failed
}
enum RefundStatus {
  None
  Waiting
  Fulfilled
  Failed
}

type UsernameRegistrationOrderError {
  status: Int
  reason: String
}
